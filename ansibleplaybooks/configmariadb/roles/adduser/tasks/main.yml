---
- set_fact: adminpass={{ hostvars['DUMMY_HOST1']['adminpass'] }}
- set_fact: userpass={{ hostvars['DUMMY_HOST2']['userpass'] }}
- name: "Upgrade all apt packages"
  apt:
    upgrade: yes
    update_cache: yes
- name: "Install python"
  apt:
    name: python3-pip
    state: present
- name: "Install pymssql"
  command:
    pip install pymssql
- name: "Add user "
  community.general.mssql_script:
    login_user: "{{ admindb }}"
    login_password: "{{ adminpass }}"
    login_host: "{{ hostdb }}"
    login_port: "3306"
    script: |
      USE "{{ dbname }}";
      CREATE USER "{{ userdb }}" IDENTIFIED BY "{{ userpass }}";
      GRANT ALL PRIVILEGES ON "{{ dbname }}".* TO "{{ userdb }}"@'%' WITH GRANT OPTION;
      FLUSH PRIVILEGES; 